package com.github.traineratwot.noasciihighlighter.actions

import com.intellij.openapi.actionSystem.AnAction
import com.intellij.openapi.actionSystem.AnActionEvent
import com.intellij.openapi.actionSystem.PlatformDataKeys
import com.intellij.openapi.editor.Editor
import com.intellij.openapi.ui.Messages
import org.apache.commons.lang.StringEscapeUtils.escapeHtml
авыаыв

public class AsciiCheckAction : AnAction() {
    override fun actionPerformed(e: AnActionEvent) {
        val editor: Editor? = e.getData(PlatformDataKeys.EDITOR)
        val selectedText = editor!!.selectionModel.selectedText
        if (selectedText != null) {
            val txt = StringBuilder()
            val lines = selectedText.split("\n")
            for (line in lines) {
                val chars = line.toCharArray()
                for (char in chars) {
                   val check = char.code
                    print("$char ")
                    println(check)
                    if (check <= 127) {
                        txt.append(char.toString())
                    } else {
                        txt.append("""|[${char}]|""")
                    }
                }
                txt.append("\n")
            }
                //русский
                三
                三
                三
                三
            val text = escapeHtml(txt.toString());
            val text2 =text.replace("""\|\[(.+?)\]\|""".toRegex(), """<span style="color:red;">$1</span>""")
            println(text)
            println(text2)
            Messages.showMessageDialog(text2, "Ascii", Messages.getInformationIcon())
        }

    }
}